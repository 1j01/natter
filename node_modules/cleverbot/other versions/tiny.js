var C=require('crypto').createHash,H=require('http'),Q=require('querystring').stringify,P="sessionid logurl vText8 vText7 vText6 vText5 vText4 vText3 vText2 prevref emotionalhistory ttsLocMP3 ttsLocTXT ttsLocTXT3 ttsText lineRef lineURL linePOST lineChoices lineChoicesAbbrev typingData divert"
.split(" "),$=module.exports=function CleverBot(_){_=this;if(!(_ instanceof $))return new $();
_._={start:'y',icognoid:'wsf',fno:0,sub:'Say',islearning:1,cleanslate:'false'},_.backlog=_.log=[];};
$.prototype.think=function(a,c){!c&&(c=a,a="{pass}");
	var z,E=Error,b=this,a=b._.stimulus=a,i=0,l,q="",w='www.cleverbot.com',u='http://'+w,
	q=Q((b._.icognocheck=C('md5').update(Q(b._).substring(9,35)).digest('hex'),b._));
	H.request({method:'POST',host:w,path:'/webservicemin',port:'80',
		headers:{'Origin':u,'Referer':u,'Accept':'*/*','Content-Type':'application/x-www-form-urlencoded','Content-Length':q.length}
	},function(f){f.on('data',function(f){q+=f}).on('end',function(x){
		x=f.statusCode;if(x!=200)c(E("HTTP "+x));else
		if(q=="DENIED")c(E("Access Denied"));else
		if(!q.match(/\r.*\r.*\r/))c(E("Not enough lines?"));else{
		for(l=q.split("\r");i<P.length;)b._[P[i]]=l[++i];r=new CleverBotResponse(l);
		c(r.A===z?E(z+"?"):b.log.push(r)&&z,r.A)}
		/*c(x=f.statusCode,x!=200?E("HTTP "+x):
		  q=="DENIED"?E("Access Denied"):
		  !q.match(/\r.*\r.*\r/)?E("Not enough lines?"):(function(){
			  for(l=q.split("\r");i<P.length;)b._[P[i]]=l[++i];r=new CleverBotResponse(l);
		  }(),r.A===z?E(z+"?"):b.log.push(r)&&z),r.A)*/
	}).setEncoding('utf8')}).on('error',c).end(q);
};
function CleverBotResponse(_,r){r=this,r.question=r.Q=_[8],r.answer=r.A=_[16]}