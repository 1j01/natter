var C=require('crypto'),H=require('http'),Q=require('querystring').stringify,P="sessionid logurl vText8 vText7 vText6 vText5 vText4 vText3 vText2 prevref emotionalhistory ttsLocMP3 ttsLocTXT ttsLocTXT3 ttsText lineRef lineURL linePOST lineChoices lineChoicesAbbrev typingData divert"
.split(" "),B=module.exports=function CleverBot(_){
	_=this;if(!(_ instanceof CleverBot))return new CleverBot();
	_._={start:'y',icognoid:'wsf',fno:0,sub:'Say',islearning:1,cleanslate:'false'},_.backlog=[];
};B.prototype={
	think:function(a,c,b){
		if(!c)c=a,a="{pass}";b=this,b.R(function(e,r,l,i,E){
			if(e)return c(e);E=Error;
			if(r=="DENIED")return c(E("Access Denied"));
			if(!r.match(/\r.*\r.*\r/))return c(E("Not enough lines?"));
			for(l=r.split("\r"),i=0;i<P.length;)b._[P[i]]=l[++i];r=new CleverBotResponse(l);
			if(r.answer===void 1)return c(E("undefined?? I don't understand! :("));
			c(void b.backlog.push(r),r.answer);
		},b._.stimulus=a);
	},R:function(c){
		var b=this,q=Q((b._.icognocheck=C.createHash('md5').update(Q(b._).substring(9,35)).digest('hex'),b._)),
			w='www.cleverbot.com',u='http://'+w,//n='no-cache',
		_=H.request({
			method:'POST',host:w,path:'/webservicemin',port:'80',
			headers:{
				//'Cache-Control':n,'Pragma':n,
				'Origin':u,'Referer':u,
				//'User-Agent':'Node',
				'Content-Type':'application/x-www-form-urlencoded',
				'Accept':'*/*',
				'Accept-Language':'en-US,en;q=0.8,ar;q=0.6',
				'Content-Length':q.length
			}
		},function(f,q){
			q="",f.on('data',function(_){q+=_})
			.on('end',function(){if(f.statusCode==200)c(void 0,q);else c(new Error("HTTP "+f.statusCode))})
			.setEncoding('utf8')
		}).on('error',c);_.end(q);return _;
	}
};function CleverBotResponse(_){this.question=_[8],this.answer=_[16]}